<div>
    <checkout-navbar :option="optionNavbar"/>
    <div class="container">
        <div class="loader" v-if="isSpinner"></div>
        <div class="row">
            <div class="col col-lg-6 col-sm-12 col-12">
                <p class="title-cart-item row">
                    <span class="col col-lg-6">Item</span>
                    <span class="col col-lg-3 offset-lg-1">Quantity</span> 
                    <span class="col col-lg-1">Price</span>
                </p>
                <hr class="hr">
                <div class="row" v-for="item in productsInCart.orderItemList" :key="item.productId" >
                    <div class="col col-lg-2">
                        <product-image :productId="item.productId" v-if="item.itemTypeEnumId=='ItemProduct'"
                           class="mb-1"/>
                    </div>
                    <div class="col col-lg-5">
                        <p class="item-text-desc">
                            <a class="item-text-desc" :href="'/store/product/' + item.productId">{{item.itemDescription}}</a>
                        </p>
                        <p v-if="item.unitListPrice" class="last-price">
                            <del>${{item.unitListPrice}}</del>
                            <span class="place-order-total"> Save ${{(item.unitListPrice - item.unitAmount).toFixed(2)}}</span>
                        </p>
                    </div>
                    <div class="col col-lg-2">
                        <input class="input-quantity form-control" id="quantity" @change="updateProductQuantity(item)" 
                            type="text" v-model="item.quantity" :disabled="item.itemTypeEnumId != 'ItemProduct'" />
                    </div>
                    <div class="col col-lg-1 offset-lg-1">
                        <p class="place-order-total">${{item.unitAmount.toFixed(2)}}</p>
                        <span class="item-actions" @click="deleteOrderProduct(item)" 
                            v-if="item.itemTypeEnumId=='ItemProduct'">
                            Delete
                        </span>
                    </div>
                </div>
                <hr>
                <div class="row div-total">
                    <span class="col col-lg-6">Subtotal</span>
                    <span class="col col-lg-1 offset-lg-4" v-if="productsInCart.orderPart">${{productsInCart.orderPart.partTotal.toFixed(2)}}</span>
                    <hr style="width: 96%;">
                    <span class="col col-lg-6 mt-4">Shipping</span>
                    <span class="place-order-total col col-lg-1 offset-lg-4 mt-4">
                        <span v-if="shippingMethod.shippingTotal != undefined">
                            ${{shippingMethod.shippingTotal.toFixed(2)}}
                        </span>
                    </span>
                    <hr style="width: 96%;">
                    <span class="col col-lg-6 mt-3 mb-5">Total</span>
                    <span class="place-order-total col col-lg-1 offset-lg-4 mt-3" v-if="productsInCart.orderHeader">
                        ${{productsInCart.orderHeader.grandTotal.toFixed(2)}}
                    </span>
                </div>
            </div>

            <!-- The whole checkout stage column -->
            <div class="col col-lg-5 offset-lg-1 col-sm-12 col-12">
                <!-- Shipping Address section title and change button -->
                <p class="title-check-text" :class="{ 'step-active': selectShippingAddressStatus == 'active', 'step-complete': selectShippingAddressStatus == 'complete'}">                
                    <span v-if="selectShippingAddressStatus == 'active'" class="circle">1</span>
                    <span v-if="selectShippingAddressStatus == 'complete'" class="circle"><i class="fa fa-check"></i></span>
                    <span class="text-address">Shipping Address</span>
                    <span data-toggle="collapse" data-target="#selectShippingAddress" v-if="selectShippingAddressStatus == 'complete'" 
                        class="text-address change-info float-right" @click="setOptionNavbar(1)">
                        Change
                    </span>
                </p>
                <!-- Horizontal dividing line -->
                <hr class="hr" :class="{ 'hr-active': selectShippingAddressStatus == 'active', 'hr-complete':selectShippingAddressStatus == 'complete' }"> 
                <!-- The selected shipping address -->
                <div v-if="selectShippingAddressStatus == 'complete'" class="div-total">
                    <span class="span-description">{{shippingAddressSelect.toName}}</span>
                    <span class="span-description">
                        {{shippingAddressSelect.address1}} {{shippingAddressSelect.address2}}
                    </span>
                    <span class="span-description">{{shippingAddressSelect.city}}</span>
                    <span class="span-description">
                        <i class="fa fa-phone phone-icon"></i>
                        {{shippingAddressSelect.contactNumber}}
                    </span>
                </div>
                <!-- The address collapses -->
                <div id="selectShippingAddress" class="collapse show">
                    <div v-for="(option, index) in listShippingAddress">
                        <div :class="{ 'div-checkmark': addressOption == option.postalContactMechId + ':' +
                            option.telecomContactMechId }">
                            <label :for="index + 'r1'" class="container-input">
                                <input :id="index + 'r1'" type="radio" :value="option.postalContactMechId + ':' +
                                    option.telecomContactMechId" v-model="addressOption" 
                                    @click="changeShippingAddress(option)"/>
                                <span class="checkmark"></span>
                                <span class="span-description">{{option.postalAddress.toName}}</span>
                                <span class="span-description">
                                    {{option.postalAddress.address1}} {{option.postalAddress.address2}}
                                </span>
                                <span class="span-description">{{option.postalAddress.city}}</span>
                                <span class="span-description">
                                    <i class="fa fa-phone phone-icon"></i>
                                    {{option.telecomNumber.contactNumber}}
                                </span>
                            </label>
                            <!-- Update and delete address icons -->
                            <span data-toggle="modal" data-target="#addressFormModal" 
                                @click="selectAddress(option),isUpdate = true" class="edit-icon">
                                <i class="fas fa-edit"></i>
                            </span>
                            <span @click="deleteShippingAddress(option.postalContactMechId,option.postalContactMechPurposeId)"
                                class="delete-icon">  
                                <i class="fas fa-trash-alt"></i>
                            </span>
                        </div>
                    </div>
                    <br>
                    <!-- Buttons    -->
                    <button data-toggle="collapse" data-target="#selectShippingAddress" 
                        @click="addCartBillingShipping('selectShippingMethod'),setOptionNavbar(2)" class="btn btn-continue float-right" 
                        :disabled="addressOption == null || addressOption == '' 
                        || listShippingAddress == null || listShippingAddress.length == 0 ">
                        Continue
                    </button>
                    <a data-toggle="modal" data-target="#addressFormModal" @click="cleanShippingAddress()" class="text-add">
                        Add a New Address
                    </a>
                </div>
                <br>
                
                <!-- Shipping method section title-->
                <p class="title-check-text"  :class="{ 'step-active': selectShippingMethodStatus == 'active', 'step-complete': selectShippingMethodStatus == 'complete' }">
                    <span v-if="selectShippingMethodStatus != 'complete'" class="circle">2</span>
                    <span v-if="selectShippingMethodStatus == 'complete'" class="circle"> <i class="fa fa-check"></i></span>
                    <span class="text-address">Shipping Method</span>
                    <span data-toggle="collapse" data-target="#selectShippingMethod" v-if="selectShippingMethodStatus == 'complete'" 
                        class="text-address change-info float-right">Change</span>
                </p>
                <!-- The selected shipping method -->
                <hr class="hr" :class="{ 'hr-active': selectShippingMethodStatus == 'active', 'hr-complete':selectShippingMethodStatus == 'complete' }">
                <div v-if="selectShippingMethodStatus == 'complete'" class="div-total">
                    <span class="span-description">
                    {{shippingMethod.shipmentMethodDescription}}
                    <span class="float-right" v-if="shippingMethod.shippingTotal">${{shippingMethod.shippingTotal.toFixed(2)}}</span>
                    </span>    
                </div>

                <!-- Shipping method collapses -->
                <div id="selectShippingMethod" class="collapse">
                    <div v-for="(option, index) in listShippingOptions">
                        <div :class="{ 'div-checkmark': shippingOption == option.carrierPartyId + ':' + option.shipmentMethodEnumId }">
                            <label :for="index + 'r2'" class="container-input">
                            <input :id="index + 'r2'" type="radio" :value="option.carrierPartyId + ':' + option.shipmentMethodEnumId" v-model="shippingOption" @click="shippingMethod = option" />
                            <span class="checkmark"></span>
                            {{option.carrierPartyId == '_NA_' ? '' : (option.carrierName + ' - ')}}
                            {{option.shipmentMethodDescription}}
                            <span class="float-right">${{option.shippingTotal}}</span>
                            </label>
                        </div>
                    </div>
                    <br>
                    <button data-toggle="collapse" data-target="#selectShippingMethod"  
                        @click="addCartBillingShipping('selectPaymentMethod'),setOptionNavbar(3)" class="btn btn-continue float-right" 
                        :disabled="shippingOption == null || shippingOption == '' || 
                        listShippingOptions == null || listShippingOptions.length == 0">
                        Continue
                    </button>
                </div>
                <br>

                <!-- Payment method section -->
                <p class="title-check-text" :class="{ 'step-active': selectPaymentMethodStatus == 'active', 'step-complete': selectPaymentMethodStatus == 'complete' }">
                    <span v-if="selectPaymentMethodStatus != 'complete'" class="circle">3</span>
                    <span v-if="selectPaymentMethodStatus == 'complete'" class="circle"><i class="fa fa-check"></i></span>
                    <span class="text-address">Payment Methods</span>
                    <span data-toggle="collapse" data-target="#selectPaymentMethod" v-if="selectPaymentMethodStatus == 'complete'" class="text-address change-info float-right">Change</span>
                </p>
                <hr class="hr" :class="{ 'hr-active': selectPaymentMethodStatus == 'active', 'hr-complete':selectPaymentMethodStatus == 'complete' }">
                <div v-if="selectPaymentMethodStatus == 'complete'" class="div-total">
                    <span class="span-description">{{paymentMethod.description}}</span>
                    <span class="span-description">{{paymentMethod.titleOnAccount}}</span>
                    <span class="span-description">{{paymentMethod.expireMonth}}/{{paymentMethod.expireYear}}</span>
                    <br>
                    <template v-if="isSameAddress == 'complete' && selectPaymentMethodStatus == 'complete'">
                        <span>Billing address:</span> 
                        <br>
                        <span class="span-description">{{paymentMethod.toName}}</span>
                        <span class="span-description">{{paymentMethod.address1}} {{paymentMethod.address2}}</span>
                        <span class="span-description">{{paymentMethod.city}}</span>
                        <span class="span-description"><i class="fa fa-phone phone-icon"></i>{{paymentMethod.contactNumber}}</span>
                    </template>
                </div>
                <span v-if="isSameAddress == 0 && selectPaymentMethodStatus == 'complete'">
                    My billing address is the same as my shipping address
                </span>
                <div id="selectPaymentMethod" class="collapse">
                    <div v-for="(item,index) in listPaymentMethods">
                        <div :class="{ 'div-checkmark': paymentOption == item.paymentMethodId }">
                            <label  :for="index + 'r3'" class="container-input">
                                <input :id="index + 'r3'"  type="radio" :value="item.paymentMethodId" v-model="paymentOption"
                                    @click="selectPaymentMethod(item)"/>
                                <span class="checkmark"></span>
                                <span class="span-description">{{item.paymentMethod.description}}</span>
                                <span class="span-description">{{item.paymentMethod.titleOnAccount}}</span>
                                <span class="span-description">Expires on {{item.creditCard.expireDate}}</span>
                            </label>
                            <span data-toggle="modal" data-target="#creditCardModal" 
                                @click="selectPaymentMethod(item),isUpdate = true" 
                                class="edit-icon icon-margin-top">
                                <i class="fas fa-edit"></i>
                            </span>
                            <span @click="deletePaymentMethod(item.paymentMethodId)" class="delete-icon icon-margin-top">
                                <i class="fas fa-trash-alt"></i>
                            </span>
                        </div>
                    </div>
                    <label class="container-input1" v-if="isSameAddress == 0">
                        <input @click="isSameAddress = '1'" type="checkbox" checked/>
                        <span class="checkmark-input"></span>
                    </label>
                    <span class="address-text" v-if="isSameAddress == 0">
                        My billing address is the same as my shipping address
                    </span>
                    <div class="div-billing-address" v-if="isSameAddress == 1">
                        <span class="address-text">Choose billing address: </span>
                        <div v-for="(option, index) in listShippingAddress" class="mt-3">
                            <div :class="{ 'div-checkmark': billingAddressOption == option.postalContactMechId + ':' +
                                option.telecomContactMechId, 'span-color': billingAddressOption != option.postalContactMechId + ':' +
                                option.telecomContactMechId }">
                                <label :for="index + 'a1'" class="container-input">
                                    <input :id="index + 'a1'" type="radio" :value="option.postalContactMechId + ':' +
                                        option.telecomContactMechId" v-model="billingAddressOption" 
                                        @click="selectBillingAddress(option)"/>
                                    <span class="checkmark"></span>
                                    <span class="span-description">{{option.postalAddress.toName}}</span>
                                    <span class="span-description">
                                       {{option.postalAddress.address1}} {{option.postalAddress.address2}}
                                    </span>
                                    <span class="span-description">{{option.postalAddress.city}}</span>
                                    <span class="span-description">
                                        <i class="fa fa-phone phone-icon"></i>
                                        {{option.telecomNumber.contactNumber}}
                                    </span>
                                </label>
                            </div>
                        </div>
                        <br>   
                        <button  @click="addCustomerPaymentMethod(),isSameAddress = '2'" class="btn btn-continue float-right">
                           Use Address
                        </button>
                        <a data-toggle="modal" data-target="#addressFormModal" @click="cleanShippingAddress()" 
                            class="text-add float-right">
                            Add a New Address
                        </a>
                    </div>
                    <br>
                    <a v-if="isSameAddress == 0 || isSameAddress ==2" data-toggle="modal" data-target="#creditCardModal" @click="cleanPaymentMethod()" class="text-add">
                        Add a Credit Card
                    </a>
                    <button v-if="isSameAddress == 0 || isSameAddress ==2" data-toggle="collapse" 
                        data-target="#selectPaymentMethod"  class="btn btn-continue float-right" 
                        @click="addCartBillingShipping('placeOrder'),setOptionNavbar(4)" 
                        :disabled="paymentOption == null || paymentOption == '' || listPaymentMethods == null ||
                        listPaymentMethods.length == 0">
                        Continue
                    </button>
                </div>
                <br>
                <p class="title-check-text" :class="{ 'step-active': placeOrderStatus == 'active', 'step-complete': placeOrderStatus == 'complete' }">
                    <span v-if="placeOrderStatus != 'complete'" class="circle">4</span>
                    <span v-if="placeOrderStatus == 'complete'" class="circle"><i class="fa fa-check"></i></span>
                    <span class="text-address">Complete Purchase</span>
                </p>
                <hr class="hr">
                <div id="placeOrder" class="collapse">
                    <div class="div-place-order">
                        <p class="text-center">YOUR TOTAL IS: 
                            <span class="place-order-total">
                                ${{productsInCart.paymentsTotal}}
                            </span>
                        </p>
                        <p class="text-center place-order-text">Place order below to complete your purchase</p>
                    </div>
                    <button class="btn btn-place-order col col-lg-12" @click="setCartPlace">Place Order</button>
                </div>
            </div>

        </div>
        <div>
            <div class="modal fade" id="creditCardModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">
                                <span v-if="isUpdate">Update Credit Card</span>
                                <span v-else>Add Credit Card</span>
                            </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div v-if="responseMessage != null && responseMessage != ''" 
                                class="alert alert-primary" role="alert">
                                {{responseMessage}}
                            </div>
                            <div class="form-group row">
                                <label for="card" class="col-sm-3 col-form-label modal-text">
                                    Card Number 
                                    <span class="modal-text-required">*</span>
                                </label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="card"
                                        type="text"
                                        v-model="paymentMethod.cardNumber"
                                        placeholder="13 to 16 digits Spaces are optional" required :disabled="isUpdate"/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="nameCard" class="col-sm-3 col-form-label">Name on Card *</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="nameCard"
                                        type="text"
                                        v-model="paymentMethod.titleOnAccount"
                                        placeholder="The name printed on the front of the card" required/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Expiry Date *</label>
                                <div class="form-group col-sm-4">
                                    <select v-model="paymentMethod.expireMonth" class="form-control">
                                        <option value="01">01</option>
                                        <option value="02">02</option>
                                        <option value="03">03</option>
                                        <option value="04">04</option>
                                        <option value="05">05</option>
                                        <option value="06">06</option>
                                        <option value="07">07</option>
                                        <option value="08">08</option>
                                        <option value="09">09</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                                <div class="form-group col-sm-5">
                                    <select v-model="paymentMethod.expireYear" class="form-control">
                                        <option value="" selected disabled>Year</option>
                                        <option value="2018">2018</option>
                                        <option value="2019">2019</option>
                                        <option value="2020">2020</option>
                                        <option value="2021">2021</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="security" class="col-sm-3 col-form-label">Card Security Code*</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="security"
                                        type="text"
                                        v-model="paymentMethod.cardSecurityCode"
                                        placeholder="3 or 4 Digits" required/>
                                </div>
                            </div>
                            <div class="row justify-content-center">
                                <button @click="addCustomerPaymentMethod" class="btn btn-continue col col-sm-6 offset-sm-1">
                                    <span v-if="isUpdate">Update Credit Card</span>
                                    <span v-else>Add Credit Card</span>
                                </button>
                                <a @click="hideModal('creditCardModal')" class="btn btn-link text-add col col-sm-9 offset-sm-1">
                                    Or Cancel
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="modal-error">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">An error occurred</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p class="text-center">{{responseMessage}}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="addressFormModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <!-- Recipient Field -->
                            <div class="form-group">
                                <label for="name" class="form-heading form-text-align">To</label>
                                <input class="input-text input-border form-control" id="name"
                                        type="text"
                                        v-model="shippingAddress.toName"
                                        @focus="resetToNameErrorMessage(shippingAddress.toName)"
                                        required/>
                                <div v-if="toNameErrorMessage != null && toNameErrorMessage != ''">
                                    <small class="input-text form-text response-text">{{toNameErrorMessage}}</small>
                                </div>
                            </div>
                            <!-- Attention Field-->
                            <div class="form-group">
                                <label class="form-heading form-text-align">Attention of
                                    <small class="text-muted">(optional)</small>
                                </label>
                                    <input class="input-text input-border form-control"  
                                            type="text" 
                                            v-model="shippingAddress.attnName"/>
                            </div>
                            <!-- Country Field-->
                            <div class="form-group">
                                <label for="country" class="form-heading form-text-align">Country</label>
                                    <select v-model="shippingAddress.countryGeoId" class="input-text input-border form-control"
                                        @change="getRegions(shippingAddress.countryGeoId)" @focus="resetCountryErrorMessage(shippingAddress.countryGeoId)">
                                        <option value="USA">United States</option>
                                    </select>
                                    <div v-if="countryErrorMessage != null && countryErrorMessage != ''">
                                        <small class="input-text form-text response-text">{{countryErrorMessage}}</small>
                                    </div>
                            </div>
                            <!-- Address -->
                            <div class="form-group">
                                <label for="adress1" class="form-heading form-text-align">Address</label>
                                <input class="input-text input-border form-control" input-border id="adress1"
                                        type="text"
                                        placeholder="Line 1"
                                        v-model="shippingAddress.address1"
                                        @focus="resetAddressErrorMessage(shippingAddress.address1)"
                                        required/>
                                <div v-if="addressErrorMessage != null && addressErrorMessage != ''">
                                    <small class="input-text form-text response-text">{{addressErrorMessage}}</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <input class="input-text input-border form-control" id="adress2"
                                    type="text"
                                    placeholder="Line 2 (optional)"
                                    v-model="shippingAddress.address2"/>
                            </div>
                            <!-- City -->
                            <div class="form-group">
                                <label for="city" class="form-heading form-text-align">City</label>
                                <input class="input-text input-border form-control" id="city"
                                        type="text"
                                        v-model="shippingAddress.city"
                                        @focus="resetCityErrorMessage(shippingAddress.city)"
                                        required/>
                                <div v-if="cityErrorMessage != null && cityErrorMessage != ''">
                                    <small class="input-text form-text response-text">{{cityErrorMessage}}</small>
                                </div>
                            </div>
                            <!-- State -->
                            <div class="form-group">
                                <label for="state" class="form-heading form-text-align">State</label>
                                <select v-model="shippingAddress.stateProvinceGeoId" class="input-text input-border form-control"
                                        @focus="resetStateErrorMessage(shippingAddress.stateProvinceGeoId)">
                                        <option v-for="region in regionsList" :value="region.geoId">{{region.geoName}}</option>
                                </select>
                                <div v-if="stateErrorMessage != null && stateErrorMessage != ''">
                                    <small class="input-text form-text response-text">{{stateErrorMessage}}</small>
                                </div>
                            </div>
                            <!-- Postal code -->
                            <div class="form-group">
                                <label for="postalcode" class="form-heading form-text-align">Postcode</label>
                                <input class="input-text input-border form-control" id="postalcode"
                                    type="text"
                                    v-model="shippingAddress.postalCode"
                                    @focus="resetPostalCodeErrorMessage(shippingAddress.postalCode)"
                                    required/>
                                <div v-if="postalCodeErrorMessage != null && postalCodeErrorMessage != ''">
                                    <small class="input-text form-text response-text">{{postalCodeErrorMessage}}</small>
                                </div>
                            </div>
                            <!-- Phone number -->
                            <div class="form-group">
                                <label for="contactnumber" class="form-heading form-text-align">Phone Number</label>
                                <input class="input-text input-border form-control" id="contactnumber"
                                    type="text"
                                    v-model="shippingAddress.contactNumber"
                                    @focus="resetContactNumberErrorMessage(shippingAddress.contactNumber)"
                                    required/>
                                <div v-if="contactNumberErrorMessage != null && contactNumberErrorMessage != ''">
                                    <small class="input-text form-text response-text">{{contactNumberErrorMessage}}</small>
                                </div>
                            </div>

                            <div class="row justify-content-center">
                                <button @click="addCustomerShippingAddress" class="btn btn-continue col col-sm-6">
                                    <span v-if="isUpdate">Update Address</span>
                                    <span v-else>Add Address</span>
                                </button>
                                <a @click="hideModal('addressFormModal')" class="btn btn-link text-add col col-sm-9">
                                    Cancel
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <p class="link-text mb-5">
            Forgot something? 
            <a href="/store" class="text-add">Head back to the shop.</a>
        </p>
    </div>
    <footer-page :infoLink="false" />
</div>